<html>
    <head>
        <title>What day of the week is today</title>
        <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
        <script type="text/javascript">
            var fallback = ['Sunday', 'Monday', 'Thuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            var langFile = {'weekdays' : fallback};
            var userLang = ((navigator.language) ? navigator.language : navigator.userLanguage).substring(0, 2);
            var day = (new Date()).getDay();
            var geoDay = day;

            jQuery(document).ajaxError(function(event, request, settings){
                console.log("Ajax error");
                $("div").append(fallback[day] + ' (fallback)');
            });

            $(document).ready(function() {
                console.log("loading language file " + userLang);
                $.getJSON('languages/' + userLang + '.json',
                    function(data) {
                         if(data != null) { 
                            langFile = data;
                            console.log("loaded language file: " + langFile);
                        } else {
                            console.log("language file is empty. Using fallback");
                            userLang = userLang + 'unsupported';
                        }
                        refresh();
                    }
                    );

                jQuery.getScript('http://www.geoplugin.net/javascript.gp', function() 
                    {
                        var lon = geoplugin_longitude();
                        var lat = geoplugin_latitude();
                        var USER = "demo";
                        console.log("Your location is: " + lon + ", " + lat);
                        $.getJSON("http://api.geonames.org/timezoneJSON?lat=" + lat + "&lng=" + lon + "&username=" + USER, 
                            function(data) {
                                if(data != null) {
                                    console.log("received timezone data: " + data);
                                } else {
                                    console.log("timezone data is empty.");
                                }
                            });
                    });
                });

            function refresh() {
                $("div").append(langFile.weekdays[day]);
            }
        </script>  
    </head>

    <body>
        <div id="dotw"></div>
    </body>

    <!-- Piwik -->
    <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(["trackPageView"]);
        _paq.push(["enableLinkTracking"]);

        (function() {
            var u=(("https:" == document.location.protocol) ? "https" : "http") + "://0xabc.de/analytics/";
            _paq.push(["setTrackerUrl", u+"piwik.php"]);
            _paq.push(["setSiteId", "3"]);
            var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
            g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Piwik Code -->
</html>

